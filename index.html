<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VM-Banner</title>
  <!-- ç«™ç‚¹å›¾æ ‡ -->
  <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
  <!-- æ ·å¼é‡ç½® -->
  <link rel="stylesheet" href="./css/reset.css">
  <!-- banner -->
  <link rel="stylesheet" href="./css/banner.css">
</head>

<body>
  <div class="banner">
    <!-- 1.å›¾ç‰‡ -->
    <ul class="images"></ul>

    <!-- 2.å·¦å³æŒ‰é’® -->
    <div class="control prev"></div>
    <div class="control next"></div>

    <!-- 3.æŒ‡ç¤ºå™¨(å°åœ†ç‚¹) -->
    <div class="indicator"></div>
  </div>

  <script src="./json/banner_data.js"></script>
  <script>
    // 0.èµ„æºæœåŠ¡åœ°å€
    var serverURL = "https://res.vmallres.com/"

    // 1.è·å–å…ƒç´ 
    var bannerEl = document.querySelector(".banner")
    var imagesEl = bannerEl.querySelector(".images")
    var indicatorEl = bannerEl.querySelector(".indicator")
    var prevBtnEl = bannerEl.querySelector(".prev")
    var nextBtnEl = bannerEl.querySelector(".next")

    // 2.å®šä¹‰å˜é‡
    var bannersCount = banners.length // bannersçš„é•¿åº¦å¤§å°
    var previousIndex = 0 // ä¸Šä¸€ä¸ªç´¢å¼•
    var currentIndex = 0 //å½“å‰ç´¢å¼•
    var timeID = null // å®šæ—¶å™¨

    // 3.æ ¹æ®æ•°æ®åŠ¨æ€æ·»åŠ é¡µé¢å†…å®¹
    // 3.1 åŠ¨æ€æ·»åŠ å›¾ç‰‡ç›¸å…³å†…å®¹
    for (var i = 0; i < bannersCount; i++) {
      // è·å–æ•°æ®
      var bannerItemEl = banners[i]

      // åˆ›å»ºliå…ƒç´ 
      var itemEl = document.createElement("li")
      itemEl.classList.add("item")
      // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
      if (i === 0) itemEl.classList.add("active")
      imagesEl.append(itemEl)


      // ğŸšš æ–¹æ³•ä¸€: ä¸€ä¸ªä¸€ä¸ªåˆ›å»ºå…ƒç´ 

      // // åˆ›å»ºaå…ƒç´ 
      // var aEl = document.createElement("a")
      // aEl.href = "#"
      // itemEl.append(aEl)

      // // åˆ›å»ºimgå…ƒç´ 
      // var imgEl = document.createElement("img")
      // imgEl.src = `${serverURL}${bannerItemEl.imgUrl}`
      // aEl.append(imgEl)

      // ğŸšš æ–¹æ³•äºŒ: innerHTML
      itemEl.innerHTML = `
        <a href="#">
            <img src="${serverURL}${bannerItemEl.imgUrl}" alt="">
        </a>
      `
    }

    // 3.2 æŒ‡ç¤ºå™¨(å°åœ†ç‚¹)æ•°æ®
    for (var i = 0; i < bannersCount; i++) {
      // åˆ›å»ºdivå…ƒç´ 
      var itemEl = document.createElement("div")
      itemEl.classList.add("item")
      // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
      if (i === 0) itemEl.classList.add("active")
      indicatorEl.append(itemEl)

      // ç›‘å¬æŒ‡ç¤ºå™¨(å°åœ†ç‚¹)çš„ç‚¹å‡»
      // ğŸšš æ–¹æ³•ä¸€
      itemEl.index = i
      itemEl.onclick = function () {
        previousIndex = currentIndex
        currentIndex = this.index
        // åˆ‡æ¢è½®æ’­å›¾
        switchBanner()
      }
    }

    // 4.è‡ªåŠ¨è½®æ’­
    startTime()

    // 5.é¼ æ ‡ç»è¿‡banneræ¸…é™¤å®šæ—¶å™¨
    bannerEl.onmouseenter = function () {
      // æ¸…é™¤å®šæ—¶å™¨
      stopTime()
    }

    // 6.é¼ æ ‡ç¦»å¼€bannerå¼€å¯å®šæ—¶å™¨
    bannerEl.onmouseleave = function () {
      // å¼€å¯å®šæ—¶å™¨
      startTime()
    }

    // 7.æŒ‡ç¤ºå™¨(å°åœ†ç‚¹)çš„ç‚¹å‡»
    // indicatorEl.onclick = function (event) {
    //   if (event.target === this) return
    //   var itemEl = event.target
    //   // è·å–ç´¢å¼•
    //   // ğŸšš æ–¹æ³•ä¸€: for
    //   // for (var i = 0; i < this.children.length; i++) {
    //   //   if (this.children[i] === itemEl) {
    //   //     var index = i
    //   //     break
    //   //   }
    //   // }

    //   // ğŸšš æ–¹æ³•äºŒ: indexOf
    //   // var index = Array.from(this.children).indexOf(itemEl)

    //   // ğŸšš æ–¹æ³•ä¸‰: findIndex
    //   var index = Array.from(this.children).findIndex(function (item) {
    //     return item === itemEl
    //   })

    //   previousIndex = currentIndex
    //   currentIndex = index
    //   // åˆ‡æ¢è½®æ’­å›¾
    //   switchBanner()
    // }

    
    // 8.å·¦å³æŒ‰é’®çš„ç‚¹å‡»
    prevBtnEl.onclick = function () {
      previousIndex = currentIndex
      currentIndex--
      if (currentIndex === -1) currentIndex = bannersCount - 1

      switchBanner()
    }

    // ç®€æ´å†™æ³•: nextBtnEl.onclick = nextSwitch ä¸æ¨è é˜…è¯»æ€§å¤ªå·® ğŸ”¥
    nextBtnEl.onclick = function () {
      // åˆ‡æ¢ä¸‹ä¸€ä¸ª
      nextSwitch()
    }

    // å°è£…å‡½æ•°:åˆ‡æ¢è½®æ’­å›¾
    function switchBanner() {
      // 1.åˆ‡æ¢å›¾ç‰‡çš„item
      // è®©currentIndexå˜æˆactiveçŠ¶æ€,è®©previousIndexå˜æˆæ™®é€šçŠ¶æ€
      var previousItemEl = imagesEl.children[previousIndex]
      var currentItemEl = imagesEl.children[currentIndex]
      previousItemEl.classList.remove("active")
      currentItemEl.classList.add("active")

      // 2.åˆ‡æ¢æŒ‡ç¤ºå™¨(å°åœ†ç‚¹)çš„item
      var previousInItemEl = indicatorEl.children[previousIndex]
      var currentInItemEl = indicatorEl.children[currentIndex]
      previousInItemEl.classList.remove("active")
      currentInItemEl.classList.add("active")
    }

    // å°è£…å‡½æ•°: å¼€å¯å®šæ—¶å™¨
    function startTime() {
      if (timeID) return
      // ç®€æ´å†™æ³•: timeID = setInterval(nextSwitch,3000) ä¸æ¨è é˜…è¯»æ€§å¤ªå·® ğŸ”¥
      timeID = setInterval(function () {
        // åˆ‡æ¢ä¸‹ä¸€ä¸ª
        nextSwitch()
      }, 3000)
    }

    // å°è£…å‡½æ•°: æ¸…é™¤å®šæ—¶å™¨
    function stopTime() {
      if (!timeID) return
      clearInterval(timeID)
      timeID = null // æ¸…é™¤å®šæ—¶å™¨ä¹‹å, å¿…é¡»timeIDèµ‹å€¼ä¸ºnull
    }

    // å°è£…å‡½æ•°: åˆ‡æ¢ä¸‹ä¸€ä¸ª
    function nextSwitch() {
      previousIndex = currentIndex
      currentIndex++
      if (currentIndex === bannersCount) currentIndex = 0
      // åˆ‡æ¢è½®æ’­å›¾
      switchBanner()
    }

    // windowçš„ç„¦ç‚¹(ç¦»å¼€æµè§ˆå™¨çª—å£æ—¶,æ¸…é™¤å®šæ—¶å™¨)
    document.onvisibilitychange = function () {
      // å¦‚æœç¦»å¼€å½“å‰æµè§ˆå™¨é¡µé¢,æ¸…é™¤å®šæ—¶å™¨; å¦‚æœåœ¨å½“å‰æµè§ˆå™¨é¡µé¢,å¼€å¯å®šæ—¶å™¨; 
      if (this.visibilityState === "hidden") {
        stopTime()
      } else if (this.visibilityState === "visible") {
        startTime()
      }
    }
  </script>
</body>

</html>